<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Joystick.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: Joystick.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * @author Sarah Osentoski - sarah.osentoski@us.bosch.com
 */

/**
 * Manage drawing the joystick and the interaction with ROS.
 */


/*global $:false */

TELEOP.Joystick = function(options) {
  var that = this;
  options = options || {};
  var ros = options.ros;
  var topic = options.topic || '/cmd_vel';
  var throttle = options.throttle || 1.0;
  var targetDiv = $('#' + options.targetId);
  var width = targetDiv.width();
  var height = targetDiv.height();

  var chars = 'abcdefghijklmnopqrstuvwxyz';
  var id = '';
  for (var i = 0; i  &lt; 16; i++) {
    id += chars[Math.floor(Math.random()*chars.length)];
  }

  targetDiv.html('&lt;canvas id="' + id + '" width="' + width + '" height="' + height + '">&lt;\/canvas>');
  var cnvs = $('#' + id);
  var canvasContext = cnvs[0].getContext('2d');

  //setup drawing
  function circle(x,y) {
    canvasContext.clearRect(0,0,width,height);
    canvasContext.save();
    canvasContext.fillStyle = 'rgba(255,255,255,1)';
    canvasContext.fillRect(0,0,width,height);
    canvasContext.restore();
    canvasContext.save();
    canvasContext.fillStyle = 'rgba(0,0,0,1)';
    canvasContext.translate(width/2,height/2);
    canvasContext.beginPath();
    canvasContext.arc(x,y,width/12,0,Math.PI*2);
    canvasContext.closePath();
    canvasContext.fill();
    canvasContext.restore();
  }

  //setup interactivity
  var ths = this;
  this.x = 0;
  this.z = 0;
  var active = false;
  var offset = cnvs.offset();
  
  //set up publisher
  var cmdVel = new ROSLIB.Topic({
    ros : ros,
    name : topic,
    messageType : 'geometry_msgs/Twist'
  });

  function activate(val) {
    active = val;
    if (!val) {
      ths.x = 0;
      ths.z = 0;
      circle(0,0);
    }
  }

  // publish a twist command based on ths.x and ths.z
  function publish_twist() {

    var twist = new ROSLIB.Message({
      angular : {
        x : 0,
        y : 0,
        z : ths.z * throttle
      },
      linear : {
        x : ths.x * throttle,
        y : 0,
        z : 0
      }
    });
    cmdVel.publish(twist);
  }
  
  cnvs.mousedown(function() {
    activate(true);
    offset = cnvs.offset();
  });
  cnvs.mouseup(function() {
    activate(false);
    publish_twist();
  });
  cnvs.hover(function(e) {}, function(e) {
    activate(false);
  });
  cnvs.mousemove(function(e) {
    if (!active) {
      return;
    }
    var jx = e.pageX - width/2 - offset.left;
    var jy = e.pageY - height/2 - offset.top;
    circle(jx,jy);
    var tz = (-jx/(width/2))*1.25;
    var tx = (-jy/(height/2))*1.25;
    if (tz &lt; -1) {
      tz = -1;
    }
    if (tz > 1) {
      tz = 1;
    }
    if (tx &lt; -1) {
      tx = -1;
    }
    if (tx > 1) {
      tx = 1;
    }
    ths.z = tz;
    ths.x = tx;

    publish_twist();
  });

  //draw the initial stick
  circle(0,0);

 /* // handle the mouse
  var body = document.getElementsByTagName('body')[0];
  body.addEventListener('mousedown', function(e) {
    handleKey(e.keyCode, true);
  }, false);
  body.addEventListener('mouseup', function(e) {
    handleKey(e.keyCode, false);
  }, false);*/

};
//TELEOP.Joystick.prototype.__proto__ = EventEmitter2.prototype;

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="TELEOP.KeyboardTeleop.html">KeyboardTeleop</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Mon Nov 11 2013 20:05:04 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
</body>
</html>
