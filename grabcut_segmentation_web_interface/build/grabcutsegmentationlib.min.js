var GRABCUTSEGMENTATIONLIB=GRABCUTSEGMENTATIONLIB||{REVISION:"1"};GRABCUTSEGMENTATIONLIB.Segmenter=function(a){var b=this;a=a||{};var c=a.ros,d=a.cameraTopic,e=a.editTopic;this.segmentationDiv=$("#"+a.segmentationDiv),this.editDiv=$("#"+a.editDiv);var f=a.canvasWidth,g=a.canvasHeight;this.widgetState="segement",this.Lock=!1;var h="grabcut-segmentation-canvas",i="grabcut-edit-canvas";this.segmentationDiv.dialog({autoOpen:!1,width:f,height:g}),this.editDiv.dialog({autoOpen:!1}),this.segmentationDiv.html('<div id="'+h+'"></div> <br> <br><button id="grabcut-segmentation">Segment</button> <button id="grabcut-reset">Reset</button>'),this.editDiv.html('<div id="'+i+'"></div> <br><br><button id="grabcut-edit-segmentation">Send</button> <button id="grabcut-edit-reset">Reset</button>');var j=(new GRABCUTSEGMENTATIONLIB.Selector({divID:h,host:"sam",width:f,height:g,topic:d}),new MJPEGCANVAS.Viewer({divID:i,host:"sam",width:f,height:g,topic:e}),new ROSLIB.Topic({ros:c,name:d,messageType:"sensor_msgs/Image"}));console.log(j),j.subscribe(function(){b.widgetState="segment",console.log("cameramessage"),b.segmentationDiv.dialog("open")}),$("#grabcut-segmentation").button().click(function(){console.log("clicked segmentation button")}),$("#grabcut-reset").button().click(function(){console.log("clicked reset button")});var k=new ROSLIB.Topic({ros:c,name:e,messageType:"sensor_msgs/Image"});k.subscribe(function(){b.widgetState="edit",b.editDiv.dialog()}),$("#grabcut-edit-segmentation").button().click(function(){console.log("clicked edit segmentation button")}),$("#grabcut-edit-reset").button().click(function(){console.log("clicked edit reset button")})},GRABCUTSEGMENTATIONLIB.Selector=function(a){var b=this,c=a.divID;this.width=a.width,this.height=a.height,this.host=a.host,this.port=a.port||8080,this.quality=a.quality;a.topic,a.overlay;this.image=new Image;new MJPEGCANVAS.ErrorIcon;this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,document.getElementById(c).appendChild(this.canvas),this.stage=new createjs.Stage(this.canvas),console.log(this.canvas),console.log(this.stage);this.canvas.getContext("2d");this.canvas.style.background="#aaaaaa";window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setInterval(a,100)};console.log(this.image.src);var d=!1,e=null,f=null,g=null,h=function(a,c){if("down"==c)console.log("mouse down"),e={x:a.stageX,y:a.stageY},f=b.stage.globalToRos(a.stageX,a.stageY),positionVec3=new ROSLIB.Vector3(f),d=!0;else if("move"===c){if(d===!0){var h={x:a.stageX,y:a.stageY},i=b.stage.globalToRos(a.stageX,a.stageY);currentPosVec3=new ROSLIB.Vector3(i);var j={x:e.x,y:e.y};e.x>h.x&&(j.x=h.x),e.y>h.y&&(j.y=h.y);var k=Math.abs(e.x-h.x),l=Math.abs(e.y-h.y);console.log(h),g&&(b.stage.removeChild(g),g=null),g=new createjs.Shape,g.graphics.beginStroke("#F00"),g.graphics.drawRect(j.x,j.y,k,l),b.stage.addChild(g),b.stage.update()}}else d=!1};this.stage.addEventListener("stagemousedown",function(a){h(a,"down")}),this.stage.addEventListener("stagemousemove",function(a){h(a,"move")}),this.stage.addEventListener("stagemouseup",function(a){h(a,"up")})},GRABCUTSEGMENTATIONLIB.Selector.prototype.__proto__=EventEmitter2.prototype,GRABCUTSEGMENTATIONLIB.Selector.prototype.changeStream=function(a){this.image=new Image;var b="http://"+this.host+":"+this.port+"/snapshot?topic="+a;b+="?width="+this.width,b+="?height="+this.height,this.quality>0&&(b+="?quality="+this.quality),this.image.src=b,this.emit("change",a)};